/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2017
 * @version   3.1.5
 *
 * Grid grouping jquery library created for yii2-grid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvGridGroup;!function(t){"use strict";kvGridGroup=function(a){var r,e,n,o,d,i,u,s,c,l,f,g,h,p,v,m,k,y,w,q,x,C;for(r=t("#"+a),e={},n=[],u=0,s=r.find("tr.kv-page-summary"),c=r.find("tr[data-key]:first"),l=r.find("tr[data-key]:last"),f=function(t){return void 0===t||null===t||0===t.length},g=function(){var a=0;s.length&&s.find("td").each(function(){t(this).attr("data-col-seq",a),a++})},h=function(t,a,r,e,n){var o="\\d(?=(\\d{"+(n||3)+"})+"+(t>0?"\\D":"$")+")",d=parseFloat(t),i=parseInt(a);return isNaN(d)?"":(d=d.toFixed(isNaN(i)||0>i?0:i),(r?d.replace(".",r):d).replace(new RegExp(o,"g"),"$&"+(e||",")))},p=function(t){var a,r,e,n,o=t.attr("data-sub-group-of");if(f(o))return null;if(n='td[data-col-seq="'+o+'"]',a=t.closest("tr"),r=a.find(n),e=r.length,e>0)return r;for(;0===e&&a.length;)a=a.prev(),r=a.find(n),e=r.length;return 0===e?null:r},v=function(t,a){var r=t.attr("data-group-key"),e=0,n=a;if(a.attr("data-last-row"))return a;for(;0===e&&n.length;)n=a,a=a.next(),e=a.find('td[data-group-key="'+r+'"]').length;return n.length?n:l},m=function(t,a,r){var e,n;return t&&t.length?(t.is("[data-raw-value]")?n=t.attr("data-raw-value"):(n=t.text(),e=new RegExp("[\\s"+r+"]","g"),n=n.replace(e,""),a&&"."!==a&&(n=n.replace(a,"."))),n?parseFloat(n):0):0},k=function(a,r,e,n,o){var d=1,i=[],u=a,s=u.hasClass("kv-grid-group-row"),c=r.attr("rowspan")||1;if(s)for(d=!1,u=u.next(":not(.kv-grid-group-row");!d&&u.length;)u.find('td[data-col-seq="'+e+'"]').each(function(){i.push(m(t(this),n,o))}),d=u.hasClass("kv-grid-group-row"),u=u.next();else for(;c>=d&&u.length;)u.find('td[data-col-seq="'+e+'"]').each(function(){i.push(m(t(this),n,o))}),u=u.next(),d++;return i},y=function(t,a,r,e,n){var o,d,i,u,s,c,l;return i=n.decimals||0,u=n.decPoint||".",s=n.thousandSep||",",d=n.format||"",l=n.func?window[n.func]:"","number"===d?(c=k(a,r,e,u,s),o=C(c,t),h(o,i,u,s)):"callback"===d&&"function"==typeof l?(c=k(a,r,e,u,s),l(c)):t},C=function(t,a){var r,e,n=0,o=t&&t.length||0;if(!o)return"";switch(a){case"f_count":return o;case"f_sum":case"f_avg":for(r=0;o>r;r++)n+=t[r];return"f_sum"===a?n:n/o;case"f_max":case"f_min":return e="f_max"===a?"max":"min",Math[e].apply(null,t);default:return""}},w=function(t,a){a=a||1;var r=t.attr("rowspan")||1;r=parseInt(r)+a,t.attr("rowspan",r)},q=function(){var a,r=[];if(l.nextAll("tr.kv-group-footer").each(function(){r.push(t(this))}),r.length)for(a=0;a<r.length;a++)l.after(r[a]);s.length&&s.find("td").each(function(){var a=t(this);c.find('td[data-col-seq="'+a.attr("data-col-seq")+'"]').length||a.remove()})},x=function(a,r){var e,n,o,d,i,u,s,l,f,g,h,m=a.data(r),k=!1,q="groupHeader"===r?"kv-group-header":"kv-group-footer";m&&(n=a.attr("data-group-key"),o=a.closest("tr"),n&&o.attr("data-group-key",n),e=a.attr("data-sub-group-of")?p(a):null,k=e&&e.length&&e.is("[data-grouped-row]"),n=e&&e.length?e.attr("data-col-seq"):null,s=t(document.createElement("tr")),m.options&&s.attr(m.options).addClass(q),c.find("td").each(function(){d=t(this),i=d.attr("data-col-seq"),(!n||i!=n||k)&&(l=t(document.createElement("td")).attr("data-summary-col-seq",i),m.content&&m.content[i]&&(h=m.contentFormats&&m.contentFormats[i]||{},g=y(m.content[i],o,a,i,h),l.html(g)),m.contentOptions&&m.contentOptions[i]&&l.attr(m.contentOptions[i]),l.appendTo(s))}),e&&e.length&&!k&&w(e),"groupHeader"===r?(o.before(s),o.find('td[data-col-seq="'+n+'"]').length&&s.find("td").each(function(){var a=t(this),r=parseInt(a.attr("data-summary-col-seq"));return n=parseInt(n),r===n-1?void a.after(e):r===n+1?void a.before(e):void(r>n&&a.before(e))})):(f=v(a,o),k&&f.hasClass("kv-grid-group-row")?f.before(s):f.after(s)),m.mergeColumns&&m.mergeColumns.length&&t.each(m.mergeColumns,function(a,r){var e=r[0],n=r[1],o=0,d="";e>-1&&n>-1&&(s.find("td").each(function(){var a=t(this);u=a.attr("data-summary-col-seq"),u>=e&&n>=u&&(d+=a.html(),o++)}),s.find("td").each(function(){var a=t(this);u=a.attr("data-summary-col-seq"),u>e&&n>=u?a.remove():u==e&&a.attr("colspan",o).html(d)}))}))},g(),r.find("td.kv-grid-group").each(function(){var a=t(this),r=t(this).attr("data-group-key");r&&(t.inArray(r,n)<0&&n.push(r),void 0===e[r]?e[r]=[a]:e[r].push(a))}),t.each(n,function(a,r){var n,o,d=e[r],i=1,u=0,s="",c="",l="",f="";t.each(d,function(t,r){s=r.text().trim(),0===s.length&&(s=null),n=d[u],a>0?(o=p(r),o&&o.length&&(c=o.attr("data-cell-key")),f=c?c+"-"+s:s):f=s,r.attr("data-cell-key",f),f==l?(i++,n.attr("rowspan",i),r.addClass("kv-temp-cells").hide()):(u=t,i=1),l=f})}),r.find("td.kv-grid-group.kv-temp-cells").remove(),t.each(n,function(a,e){var n=0;r.find('td[data-group-key="'+e+'"]').each(function(){var a,r=t(this),e=n%2>0?r.attr("data-odd-css"):r.attr("data-even-css");e&&r.removeClass(e).addClass(e),r.is("[data-grouped-row]")&&(a=t(document.createElement("tr")).addClass("kv-grid-group-row"),r.closest("tr").before(a),r.removeAttr("rowspan").appendTo(a).css("width","auto")),n++})}),o=r.find("tr.kv-grid-group-row"),o.length&&(u=r.find("tr[data-key]:first > td").length,u&&o.each(function(){t(this).find(">td").attr("colspan",u)}),o.find("td[data-group-key]").each(function(){var a=t(this).data("groupKey"),e=r.find(".kv-grid-group-header[data-group-key]"),n=r.find(".kv-grid-group-filter[data-group-key]");t(this).closest("tr").data("groupKey",a),e.length&&r.find('.kv-grid-group-header[data-group-key="'+a+'"]').remove(),n.length&&r.find('.kv-grid-group-filter[data-group-key="'+a+'"]').remove()})),l.attr("data-last-row",1),i=n.length-1,d=i;d>=0;d--)r.find('td[data-group-key="'+n[d]+'"]').each(function(){x(t(this),"groupFooter")});for(d=0;i>=d;d++)r.find('td[data-group-key="'+n[d]+'"]').each(function(){x(t(this),"groupHeader")});q()}}(window.jQuery);