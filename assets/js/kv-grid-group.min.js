/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version   3.1.1
 *
 * Grid grouping jquery library created for yii2-grid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvGridGroup;!function(t){"use strict";kvGridGroup=function(a){var e,r,n,o,d,i,s,u,c,f,l,h,g,p,v,m,k,y,w,q,_;for(e=t("#"+a),r={},n=[],s=0,u=e.find("tr.kv-page-summary"),c=e.find("tr[data-key]:first"),f=e.find("tr[data-key]:last"),l=function(t){return void 0===t||null===t||0===t.length},h=function(){var a=0;u.length&&u.find("td").each(function(){t(this).attr("data-col-seq",a),a++})},g=function(t,a,e,r){t=(t+"").replace(/[^0-9+\-Ee.]/g,"");var n,o=isFinite(+t)?+t:0,d=isFinite(+a)?Math.abs(a):0,i="undefined"==typeof r?",":r,s="undefined"==typeof e?".":e,u=function(t,a){var e=Math.pow(10,a);return""+Math.round(t*e)/e};return n=(d?u(o,d):""+Math.round(o)).split("."),n[0].length>3&&(n[0]=n[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(n[1]||"").length<d&&(n[1]=n[1]||"",n[1]+=new Array(d-n[1].length+1).join("0")),n.join(s)},p=function(t,a,e,r,n){var o,d,i,s,u;return"number"===a.format?(o=a.decimals||0,d=a.decPoint||".",i=a.thousandSep||",",g(t,o,d,i)):"callback"===a.format&&(u=window[a.func],"function"==typeof u)?(s=k(e,r,n),u(t,s)):t},v=function(t){var a,e,r,n,o=t.attr("data-sub-group-of");if(l(o))return null;if(n='td[data-col-seq="'+o+'"]',a=t.closest("tr"),e=a.find(n),r=e.length,r>0)return e;for(;0===r&&a.length;)a=a.prev(),e=a.find(n),r=e.length;return 0===r?null:e},m=function(t,a){var e=t.attr("data-group-key"),r=0,n=a;if(a.attr("data-last-row"))return a;for(;0===r&&n.length;)n=a,a=a.next(),r=a.find('td[data-group-key="'+e+'"]').length;return n.length?n:f},k=function(a,e,r){var n=1,o=[],d=a,i=d.hasClass("kv-grid-group-row"),s=e.attr("rowspan")||1;if(i)for(n=!1,d=d.next(":not(.kv-grid-group-row");!n&&d.length;)d.find('td[data-col-seq="'+r+'"]').each(function(){var a=t(this).text().replace(/[\s,]+/g,"");a=parseFloat(a),o.push(a)}),n=d.hasClass("kv-grid-group-row"),d=d.next();else for(;s>=n&&d.length;)d.find('td[data-col-seq="'+r+'"]').each(function(){var a=t(this).text().replace(/[\s,]+/g,"");a=parseFloat(a),o.push(a)}),d=d.next(),n++;return o},y=function(a,e,r,n){var o,d,i,s=0;switch(a){case"f_count":case"f_sum":case"f_avg":case"f_max":case"f_min":switch(d=k(e,r,n),a){case"f_count":return d.length;case"f_sum":case"f_avg":return t.each(d,function(t,a){s+=a}),"f_sum"===a?s:(i=d.length,i?s/i:s);case"f_max":case"f_min":return o=a.replace("f_",""),Math[o].apply(null,d)}return null;default:return a}},w=function(t,a){a=a||1;var e=t.attr("rowspan")||1;e=parseInt(e)+a,t.attr("rowspan",e)},q=function(){var a,e=[];if(f.nextAll("tr.kv-group-footer").each(function(){e.push(t(this))}),e.length)for(a=0;a<e.length;a++)f.after(e[a]);u.length&&u.find("td").each(function(){var a=t(this);c.find('td[data-col-seq="'+a.attr("data-col-seq")+'"]').length||a.remove()})},_=function(a,e){var r,n,o,d,i,s,u,f,l,h,g=a.data(e),k=!1,q="groupHeader"===e?"kv-group-header":"kv-group-footer";g&&(n=a.attr("data-group-key"),o=a.closest("tr"),n&&o.attr("data-group-key",n),r=a.attr("data-sub-group-of")?v(a):null,k=r&&r.length&&r.is("[data-grouped-row]"),n=r&&r.length?r.attr("data-col-seq"):null,u=t(document.createElement("tr")),g.options&&u.attr(g.options).addClass(q),c.find("td").each(function(){d=t(this),i=d.attr("data-col-seq"),(!n||i!=n||k)&&(f=t(document.createElement("td")).attr("data-summary-col-seq",i),g.content&&g.content[i]&&(h=y(g.content[i],o,a,i),g.contentFormats&&g.contentFormats[i]&&(h=p(h,g.contentFormats[i],o,a,i)),f.html(h)),g.contentOptions&&g.contentOptions[i]&&f.attr(g.contentOptions[i]),f.appendTo(u))}),r&&r.length&&!k&&w(r),"groupHeader"===e?(o.before(u),o.find('td[data-col-seq="'+n+'"]').length&&u.find("td").each(function(){var a=t(this),e=parseInt(a.attr("data-summary-col-seq"));return n=parseInt(n),e===n-1?void a.after(r):e===n+1?void a.before(r):void(e>n&&a.before(r))})):(l=m(a,o),k&&l.hasClass("kv-grid-group-row")?l.before(u):l.after(u)),g.mergeColumns&&g.mergeColumns.length&&t.each(g.mergeColumns,function(a,e){var r=e[0],n=e[1],o=0,d="";r>-1&&n>-1&&(u.find("td").each(function(){var a=t(this);s=a.attr("data-summary-col-seq"),s>=r&&n>=s&&(d+=a.html(),o++)}),u.find("td").each(function(){var a=t(this);s=a.attr("data-summary-col-seq"),s>r&&n>=s?a.remove():s==r&&a.attr("colspan",o).html(d)}))}))},h(),e.find("td.kv-grid-group").each(function(){var a=t(this),e=t(this).attr("data-group-key");e&&(t.inArray(e,n)<0&&n.push(e),void 0===r[e]?r[e]=[a]:r[e].push(a))}),t.each(n,function(a,e){var n,o,d=r[e],i=1,s=0,u="",c="",f="",l="";t.each(d,function(t,e){u=e.text().trim(),n=d[s],a>0?(o=v(e),o&&o.length&&(c=o.attr("data-cell-key")),l=c?c+"-"+u:u):l=u,e.attr("data-cell-key",l),l==f?(i++,n.attr("rowspan",i),e.addClass("kv-temp-cells").hide()):(s=t,i=1),f=l})}),e.find("td.kv-grid-group.kv-temp-cells").remove(),t.each(n,function(a,r){var n=0;e.find('td[data-group-key="'+r+'"]').each(function(){var a,e=t(this),r=e.attr(n%2>0?"data-odd-css":"data-even-css");r&&e.removeClass(r).addClass(r),e.is("[data-grouped-row]")&&(a=t(document.createElement("tr")).addClass("kv-grid-group-row"),e.closest("tr").before(a),e.removeAttr("rowspan").appendTo(a).css("width","auto")),n++})}),o=e.find("tr.kv-grid-group-row"),o.length&&(s=e.find("tr[data-key]:first > td").length,s&&o.each(function(){t(this).find(">td").attr("colspan",s)}),o.find("td[data-group-key]").each(function(){var a=t(this).data("groupKey"),r=e.find(".kv-grid-group-header[data-group-key]"),n=e.find(".kv-grid-group-filter[data-group-key]");t(this).closest("tr").data("groupKey",a),r.length&&e.find('.kv-grid-group-header[data-group-key="'+a+'"]').remove(),n.length&&e.find('.kv-grid-group-filter[data-group-key="'+a+'"]').remove()})),f.attr("data-last-row",1),i=n.length-1,d=i;d>=0;d--)e.find('td[data-group-key="'+n[d]+'"]').each(function(){_(t(this),"groupFooter")});for(d=0;i>=d;d++)e.find('td[data-group-key="'+n[d]+'"]').each(function(){_(t(this),"groupHeader")});q()}}(window.jQuery);