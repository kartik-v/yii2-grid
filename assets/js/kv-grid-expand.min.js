/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.1
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(a){var t=e.gridId,n=e.hiddenFromExport,o=e.detailUrl,l=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,v=e.collapseTitle,c=e.expandAllTitle,p=e.collapseAllTitle,u=n?e.rowCssClass+" skip-export":e.rowCssClass,k=e.animationDuration,f=a("#"+t),x=f.find(".kv-expand-header-cell"),w=x.find(".kv-expand-header-icon"),g=void 0===e.collapseAll?!1:e.collapseAll,h=void 0===e.expandAll?!1:e.expandAll,m=f.find("td:visible .kv-expand-row:not(.kv-state-disabled)"),C=m.length,R="kv-expand-detail-loading",N=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},A=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},b=function(e,a){e.removeClass(a).addClass(a)},y=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},T=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},E=function(e){b(e,R)},I=function(e){var a=isNaN(k)?1e3:k+200;setTimeout(function(){e.removeClass(R)},a)};return 0===m.length?void b(x,"kv-state-disabled"):(m.each(function(){var e,t,n=a(this),c=n.find(".kv-expand-icon"),p=n.closest("tr"),m=n.closest(".kv-expand-icon-cell"),b=n.find(".kv-expand-detail"),D=n.find(".kv-expanded-row"),L=D.data("key"),F=D.data("index"),U=p.find("td:visible").length,j={};if(!N(c)&&!A(c))return!0;0===D.length&&(L=p.data("key"),e=p.next('tr.kv-expand-detail-row[data-key="'+L+'"]'),D=e.find(".kv-expanded-row"));var K=function(e){if(E(m),o.length>0&&0===D.html().length){f.trigger("kvexprow.beforeLoad",[F,L]);var t=D.data();for(var n in t)t.hasOwnProperty(n)&&n.match(/param/)&&(j[n.replace(/param/,"").toLowerCase()]=t[n]);return void D.load(o,a.extend({},{expandRowKey:L,expandRowInd:F},j),function(){I(m),l&&a.isFunction(l)&&l(),e(),f.trigger("kvexprow.loaded",[F,L])})}I(m),e()},O=function(e){f.find('tr[data-index="'+F+'"]').remove(),D.hide(),p.after(D);var a='<tr class="kv-expand-detail-row '+u+'" data-key="'+L+'" data-index="'+F+'">';D.wrap('<td colspan="'+U+'">').parent().wrap(a),c.html(s),m.attr("title",v),e?D.slideDown(k,function(){T(c)}):(D.show(),T(c)),0===o.length&&I(m)},P=function(){E(m),b.html(""),c.html(i),m.attr("title",r),t=D.closest(".kv-expand-detail-row"),D.slideUp(k,function(){D.unwrap().unwrap(),D.appendTo(b),y(c)}),I(m)};return h&&d?(A(c)&&K(function(){O(!0),kvRowNum++,kvRowNum>=C&&(I(x),w.focus())}),kvRowNum>=C&&(I(x),w.focus()),!0):g&&d?(N(c)&&(P(),kvRowNum++,kvRowNum>=C&&(I(x),w.focus())),kvRowNum>=C&&(I(x),w.focus()),!0):(N(c)&&O(!1),void m.off().on("click",function(){return m.hasClass(R)?void 0:A(c)?(K(function(){O(!0)}),f.trigger("kvexprow.toggle",[F,L,!0]),void c.focus()):void(N(c)&&(P(),f.trigger("kvexprow.toggle",[F,L,!1]),c.focus()))}))}),void(d&&x.off().on("click",function(){if(!x.hasClass(R)&&0!==m.length){var t=A(w),n=N(w),o=a.extend({},e,{expandAll:n,collapseAll:t});E(x),n?(kvRowNum=m.find(".kv-state-collapsed").length,y(w),w.html(s),x.attr("title",p),f.trigger("kvexprow.toggleAll",[!1])):t&&(kvRowNum=m.find(".kv-state-expanded").length,T(w),w.html(i),x.attr("title",c),f.trigger("kvexprow.toggleAll",[!0])),kvExpandRow(o)}})))}(window.jQuery)};