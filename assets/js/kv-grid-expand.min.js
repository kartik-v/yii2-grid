/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2017
 * @version   3.1.7
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;!function(e){"use strict";kvExpandRow=function(n){var a=".kvExpandRowColumn",t=n.gridId,o=n.hiddenFromExport,l=n.detailUrl,d=n.onDetailLoaded,i=n.expandIcon,s=n.collapseIcon,r=n.expandTitle,c=n.collapseTitle,v=n.expandAllTitle,p=n.collapseAllTitle,f=n.expandOneOnly,u=n.enableRowClick,k=n.rowClickExcludedTags,x=n.enableCache,h=n.extraData,w=o?n.rowCssClass+" skip-export":n.rowCssClass,g=n.animationDuration,m=e("#"+t),C=m.find(".kv-expand-header-cell.kv-batch-toggle"),R=C.find(".kv-expand-header-icon"),A=void 0===n.collapseAll?!1:n.collapseAll,N=void 0===n.expandAll?!1:n.expandAll,y=m.find("td .kv-expand-row."+t+":not(.kv-state-disabled)"),b=y.length,E="kv-expand-detail-loading",T=function(){var n=m.find(".kv-expand-icon:first").closest("tr"),a=0;return n.length?(n=n.clone(),n.find(".kv-expand-row").remove(),n.find("td").each(function(){"none"!==e(this).css("display")&&a++}),a):0},I=T(),D=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},j=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},L=function(e,n){e.length&&e.removeClass(n).addClass(n)},O=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},U=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},F=function(e){L(e,E)},K=function(e){if(e.length){var n=isNaN(g)?1e3:g+200;setTimeout(function(){e.removeClass(E)},n)}},Q=function(e,n,t,o){var l=o?n:n.split(" ").join(a+" ")+a;e.length&&e.off(l).on(l,t)};return 0===h.length&&(h={}),0===y.length?void L(C,"kv-state-disabled"):(y.each(function(){var a,o,v=e(this),p=v.find(".kv-expand-icon."+t),T=v.find(".kv-expand-icon"),L=v.closest("tr"),q=v.closest(".kv-expand-icon-cell"),z=v.find(".kv-expand-detail."+t),B=v.find(".kv-expanded-row."+t+":first"),G=B.data("key"),H=B.data("index");if(!D(p)&&!j(p))return!0;0===B.length&&(G=L.data("key"),a=L.next('tr.kv-expand-detail-row[data-key="'+G+'"]'),B=a.find(".kv-expanded-row"));var J=function(n){var a=e.extend({expandRowKey:G,expandRowInd:H},h),t=x?0===B.html().length:!0;return F(q),l.length>0&&t?(m.trigger("kvexprow:beforeLoad",[H,G,h]),void B.load(l,a,function(){K(q),"function"==typeof d&&d(),n(),m.trigger("kvexprow:loaded",[H,G,h])})):(K(q),void n())},M=function(n){m.find('tr[data-index="'+H+'"]').remove(),B.hide(),L.after(B);var a='<tr class="kv-expand-detail-row '+w+'" data-key="'+G+'" data-index="'+H+'">';B.wrap('<td colspan="'+I+'">').parent().wrap(a),p.html(s),q.attr("title",c),n?B.slideDown(g,function(){U(p),B.show()}):(B.show(),U(p));var t=L.prevAll();t.push(L);var o=L.index()+1;e.each(t,function(n,a){var t=e(a).find("td[rowspan]");e.each(t,function(n,t){var l=parseInt(e(t).attr("rowspan"));e(a).index()+l>o&&e(t).attr("rowspan",l+1)})}),0===l.length&&K(q)},P=function(){F(q),z.html(""),T.html(i),q.attr("title",r),o=B.closest(".kv-expand-detail-row"),B.slideUp(g,function(){B.unwrap().unwrap(),B.appendTo(z),O(T);var n=L.prevAll();n.push(L);var a=L.index()+1;e.each(n,function(n,t){var o=e(t).find("td[rowspan]");e.each(o,function(n,o){var l=parseInt(e(o).attr("rowspan"));e(t).index()+l>a&&e(o).attr("rowspan",l-1)})})}),K(q)},S=function(){var a,t,o=!1,l=!1;if(!q.hasClass(E)){if(j(p)){if(t=f&&!A){if(a=e.extend({},n,{collapseAll:!0}),y.each(function(){return e(this).closest(".kv-expand-icon-cell").hasClass(E)?void(l=!0):void 0}),l)return;kvExpandRow(a),o=!0}return J(function(){M(!0)}),void(t&&!o||(m.trigger("kvexprow:toggle",[H,G,h,!0]),p.focus()))}D(p)&&(P(),m.trigger("kvexprow:toggle",[H,G,h,!1]),p.focus())}};return N?(j(p)&&J(function(){M(!0),kvRowNum++,kvRowNum>=b&&(K(C),R.focus())}),kvRowNum>=b&&(K(C),R.focus()),!0):A?(D(p)&&(P(),kvRowNum++,kvRowNum>=b&&(K(C),R.focus())),kvRowNum>=b&&(K(C),R.focus()),!0):(D(p)&&(l?J(function(){M(!1)}):M(!1)),Q(q,"click",function(){S(q)}),void Q(L,"click",function(n){var a=n.target,t=e(a).length&&e(a).hasClass("kv-disable-click")||-1!==e.inArray(a.nodeName,k);u&&!t&&S(q)}))}),void(C.length&&Q(C,"click",function(){if(!C.hasClass(E)&&0!==y.length){var a=j(R),t=D(R),o=e.extend({},n,{expandAll:t,collapseAll:a});F(C),t?(kvRowNum=y.find(".kv-state-collapsed").length,O(R),R.html(s),C.attr("title",p),m.trigger("kvexprow:toggleAll",[h,!1])):a&&(kvRowNum=y.find(".kv-state-expanded").length,U(R),R.html(i),C.attr("title",v),m.trigger("kvexprow:toggleAll",[h,!0])),kvExpandRow(o)}})))}}(window.jQuery);
