/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2019
 * @version   3.3.4
 *
 * Grid grouping jquery library created for yii2-grid.
 *
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2019, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvGridGroup;!function(t){"use strict";kvGridGroup=function(a){var r,e,n,o,d,i,s,u,c,f,l,h,p,g,v,m,k,y,w,q,C,x,b,A,F,_="tr."+a,I="td."+a;for(r=t("#"+a),e={},n=[],s=0,u=r.find(_+".kv-page-summary"),c=r.find(_+"[data-key]:first"),f=r.find(_+"[data-key]:last"),l=function(t){return void 0===t||null===t||0===t.length},h=function(t,a,r,e,n){var o,d="\\d(?=(\\d{"+(n||3)+"})+"+(a>0?"\\D":"$")+")",i=parseFloat(t),s=parseInt(a);return isNaN(i)?"":(o=i+"",r=r||".",e=e||",",-1===o.indexOf(".")&&s>0&&(i=parseFloat(i+".0")),o=i.toFixed(isNaN(s)||0>s?0:s),o=o.replace(".",r),o.replace(new RegExp(d,"g"),"$&"+e))},p=function(t,a){var r,e,n=0,o=t&&t.length||0;if(!o)return"";switch(a){case"f_count":return o;case"f_sum":case"f_avg":for(r=0;o>r;r++)n+=t[r];return"f_sum"===a?n:n/o;case"f_max":case"f_min":return e="f_max"===a?"max":"min",Math[e].apply(null,t);default:return""}},g=function(t){var a,r,e,n,o=t.attr("data-sub-group-of");if(l(o))return null;if(n=I+'[data-col-seq="'+o+'"]',a=t.closest("tr"),r=a.find(n),e=r.length,e>0)return r;for(;0===e&&a.length;)a=a.prev(),r=a.find(n),e=r.length;return 0===e?null:r},v=function(t,a){var r=t.attr("data-group-key"),e=0,n=a;if(a.attr("data-last-row"))return a;for(;0===e&&n.length;)n=a,a=a.next(),e=a.find(I+'[data-group-key="'+r+'"]').length;return n.length?n:f},m=function(t){for(var a=t,r="";a&&a.length;)r+=a.text().trim(),a=g(a);return r},k=function(t,a,r){var e;return t&&t.length?(t.is("[data-raw-value]")?e=t.attr("data-raw-value"):(e=t.text().split(r||",").join(""),a&&"."!==a&&(e=e.replace(a,"."))),e?parseFloat(e):0):0},y=function(a,r,e,n,o){var d=1,i=[],s=a,u=s.hasClass("kv-grid-group-row"),c=r.attr("rowspan")||1;if(u)for(d=!1,s=s.next(":not(.kv-grid-group-row)");!d&&s.length;)s.find(' > td[data-col-seq="'+e+'"]').each(function(){i.push(k(t(this),n,o))}),d=s.hasClass("kv-grid-group-row"),s=s.next();else for(;c>=d&&s.length;)s.find(' > td[data-col-seq="'+e+'"]').each(function(){i.push(k(t(this),n,o))}),s=s.next(),d++;return i},w=function(t,a,r,e,n){var o=n.format||"",d=n.func?window[n.func]:"",i=n.decPoint||".",s=n.thousandSep||",",u="number"===o||"callback"===o&&"function"==typeof d?y(a,r,e,i,s):t;return F(t,u,n)},q=function(){var a=0;u.length&&u.find(" > td").each(function(){t(this).attr("data-col-seq",a),a++})},F=function(t,a,r){var e,n=r.decimals||0,o=r.decPoint||".",d=r.thousandSep||",",i=r.format||"",s=r.func?window[r.func]:"";return"number"===i?(e=p(a,t),h(e,n,o,d)):"callback"===i&&"function"==typeof s?s(a):t},C=function(t,a){if(!t[0].hasAttribute("data-grouped-row")){a=a||1;var r=t.attr("rowspan")||1;r=parseInt(r)+a,t.attr("rowspan",r)}},x=function(){var a,r=[];if(f.nextAll(_+".kv-group-footer").each(function(){r.push(t(this))}),r.length)for(a=0;a<r.length;a++)f.after(r[a]);u.length&&u.find(" > td").each(function(){var a=t(this);c.find(' > td[data-col-seq="'+a.attr("data-col-seq")+'"]').length||a.remove()})},b=function(){var e,o=n.length,d=r.find("tbody:first"),i=d.find(_+".kv-group-footer").length;3>o||!i||(d.find(" > "+_+"[data-group-key]").each(function(){var a=t(this);a.find("> td.kv-grid-group").each(function(){var r=t(this),e=r.attr("data-sub-group-of")||"0",n=0,o=!0;a.nextAll().each(function(){o&&(n++,t(this).attr("data-group-seq")===e&&(o=!1))}),r[0].hasAttribute("data-grouped-row")||r.attr("rowspan",n)})}),d.find(" > "+_+".kv-group-footer").each(function(){var a=t(this),r=parseInt(a.attr("data-group-seq")||0);for(e=1;r>=e;e++)a.find("> td[data-summary-col-seq="+e+"]").remove()}),d.find(" > "+_+".kv-group-footer > td").each(function(){var r,e,n,o,d,i=t(this),s=i.data("groupSummary")||null,u=[],c=!0;s&&(r=s.config,(r.format||r.func)&&(e=i.attr("data-summary-col-seq"),o=i.closest("tr"),n=o.attr("data-group-seq"),o.prevAll("."+a).each(function(){var a,o=t(this),d=o.attr("data-group-seq")||"-1";c&&(a=k(o.find("> td[data-col-seq="+e+"]"),r.decPoint,r.thousandSep),u.push(a),d===n&&(c=!1))}),d=F(s.source||"",u,r),i.html(d)))}))},A=function(r,e){var o,d,i,s,u,f,l,h,p,m,k,y=r.data(e),q=!1,x="groupHeader"===e?"kv-group-header":"kv-group-footer";y&&(d=r.attr("data-group-key"),i=r.closest("tr"),d&&i.attr("data-group-key",d),o=r.attr("data-sub-group-of")?g(r):null,q=o&&o.length&&o.is("[data-grouped-row]"),d=o&&o.length?o.attr("data-col-seq"):null,l=t(document.createElement("tr")).addClass(a),y.options&&l.attr(y.options),l.addClass(x).addClass(a).attr({"data-group-seq":d||"0"}),c.find("> td").each(function(){var e;s=t(this),u=s.attr("data-col-seq"),d&&u===d&&!q||(h=t(document.createElement("td")).addClass(a).attr("data-summary-col-seq",u),y.content&&y.content[u]&&(k=y.contentFormats&&y.contentFormats[u]||{},m=w(y.content[u],i,r,u,k),e={source:y.content[u],config:k},h.html(m).data("groupSummary",e)),y.contentOptions&&y.contentOptions[u]&&h.attr(y.contentOptions[u]),s.hasClass("kv-grid-hide")&&h.addClass("kv-grid-hide"),s.hasClass("skip-export")&&h.addClass("skip-export"),h.appendTo(l))}),o&&o.length&&!q&&n.length<3&&C(o),"groupHeader"===e?(i.before(l),i.find('> td[data-col-seq="'+d+'"]').length&&l.find(" > td").each(function(){var a=t(this),r=parseInt(a.attr("data-summary-col-seq"));return d=parseInt(d),r===d-1?void a.after(o):r===d+1?void a.before(o):void(r>d&&a.before(o))})):(p=v(r,i),q&&p.hasClass("kv-grid-group-row")?p.before(l):p.after(l)),y.mergeColumns&&y.mergeColumns.length&&t.each(y.mergeColumns,function(a,r){var e=r[0],n=r[1],o=0,d="";e>-1&&n>-1&&(l.find(" > td").each(function(){var a=t(this);f=a.attr("data-summary-col-seq"),f>=e&&n>=f&&(d+=a.html(),o++)}),l.find(" > td").each(function(){var a=t(this);f=parseInt(a.attr("data-summary-col-seq")||-1),f>e&&n>=f?a.remove():f===e&&a.attr("colspan",o).html(d)}))}))},q(),r.find(_+"> td.kv-grid-group").each(function(){var a=t(this),r=t(this).attr("data-group-key");r&&(t.inArray(r,n)<0&&n.push(r),void 0===e[r]?e[r]=[a]:e[r].push(a))}),t.each(n,function(a,r){var n,o=e[r],d=1,i=0,s="",u="";t.each(o,function(t,r){n=o[i],u=a>0?m(r):r.text().trim(),u===s?(d++,n[0].hasAttribute("data-grouped-row")||n.attr("rowspan",d),r.addClass("kv-temp-cells").hide()):(i=t,d=1),s=u})}),r.find(_+"> td.kv-grid-group.kv-temp-cells").remove(),t.each(n,function(e,n){var o=0;r.find(_+'> td[data-group-key="'+n+'"]').each(function(){var r,e=t(this),n=o%2>0?e.attr("data-odd-css"):e.attr("data-even-css");n&&e.removeClass(n).addClass(n),e.is("[data-grouped-row]")&&(r=t(document.createElement("tr")).addClass("kv-grid-group-row "+a),e.closest("tr").before(r),e.removeAttr("rowspan").appendTo(r).css("width","auto")),o++})}),o=r.find(_+".kv-grid-group-row"),o.length&&(s=r.find(_+"[data-key]:first > td").length,s&&o.each(function(){t(this).find(">td").attr("colspan",s)}),o.find("> td[data-group-key]").each(function(){var e="."+a+".kv-grid-group-header",n="."+a+".kv-grid-group-filter",o=t(this).data("groupKey"),d=r.find(e+"[data-group-key]"),i=r.find(n+"[data-group-key]");t(this).closest("tr").data("groupKey",o),d.length&&r.find(e+'[data-group-key="'+o+'"]').remove(),i.length&&r.find(n+'[data-group-key="'+o+'"]').remove()})),f.attr("data-last-row",1),i=n.length-1,d=i;d>=0;d--)r.find(_+'> td[data-group-key="'+n[d]+'"]').each(function(){A(t(this),"groupFooter")});for(d=0;i>=d;d++)r.find(_+'> td[data-group-key="'+n[d]+'"]').each(function(){A(t(this),"groupHeader")});x(),b()}}(window.jQuery);