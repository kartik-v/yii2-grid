/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2023
 * @version   3.5.1
 *
 * jQuery methods library for yii2-grid expand row column
 *
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2023, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvExpandRow;!function(e){"use strict";var t=".kvExpandRowColumn",a=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},n=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},l=function(e,t){e.length&&e.removeClass(t).addClass(t)},o=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},i=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},d=function(e,a,n,l){var o=l?a:a.split(" ").join(t+" ")+t;e.length&&e.off(o).on(o,n)};kvExpandRow=function(t,s){var r,c,p,v,f="kvRowNum_"+s,u=t.gridId,h=t.hiddenFromExport,x=t.detailUrl,g=t.onDetailLoaded,k=t.expandIcon,w=t.collapseIcon,$=t.expandTitle,m=t.collapseTitle,C=t.expandAllTitle,y=t.collapseAllTitle,A=t.expandOneOnly,b=t.enableRowClick,I=t.rowClickExcludedTags,N=t.enableCache,R=t.extraData,T=t.msgDetailLoading,E=h?t.rowCssClass+" skip-export":t.rowCssClass,K=t.animationDuration,D=e("#"+u),j="."+s,L=D.find(".kv-expand-header-cell.kv-batch-toggle"+j),O=L.find(".kv-expand-header-icon"),P=void 0!==t.collapseAll&&t.collapseAll,S=void 0!==t.expandAll&&t.expandAll,U=D.find("td.kv-expand-icon-cell"+j+" .kv-expand-row:not(.kv-state-disabled)"),F=U.length,Q="kv-expand-detail-loading",_=function(){var t=D.find("td.kv-expand-icon-cell"+j+":first"),a=t&&t.length?t.closest("tr"):"",n=0;return a&&a.length?(a.find("> td").each((function(){"none"!==e(this).css("display")&&n++})),n):0}(),q=function(e){l(e,Q)},z=function(e){if(e.length){var t=isNaN(K)?1e3:K+200;setTimeout((function(){e.removeClass(Q)}),t)}},B=function(){var e=D.data(f);return e=e?parseInt(e):0,isNaN(e)?0:e},G=function(e){D.data(f,e)},H=function(){var e=B();D.data(f,e+1)},J=function(){G(U.find(".kv-state-expanded").length),o(O),O.html(w),L.attr("title",y)},M=function(){G(U.find(".kv-state-collapsed").length),i(O),O.html(k),L.attr("title",C)};(r=function(e){this.$element=e,this.init()}).prototype={constructor:r,init:function(){var e,t=this;t.$row=t.$element.closest("tr"),t.$icon=t.$element.find(">.kv-expand-icon"),t.$detail=t.$element.find(".kv-expanded-row"+j+":first"),t.$cell=t.$icon.closest(".kv-expand-icon-cell"),t.$container=t.$cell.find(".kv-expand-detail:first"),t.vKey=t.$detail.data("key"),t.vInd=t.$detail.data("index"),0===t.$detail.length&&(t.vKey=t.$row.data("key"),e=t.$row.next('tr.kv-expand-detail-row[data-key="'+t.vKey+'"]'),t.$detail=e.find(".kv-expanded-row"))},run:function(){var t=this,l=t.$row,o=t.$cell,i=t.$icon;return S?(n(i)&&t.load((function(){t.expand(!0),H(),B()>=F&&(z(L),O.focus())})),void(B()>=F&&(z(L),O.focus()))):P?(a(i)&&(t.collapse(),H(),B()>=F&&(z(L),O.focus())),void(B()>=F&&(z(L),O.focus()))):(a(i)&&(x?t.load((function(){t.expand(!1)})):t.expand(!1)),d(o,"click",(function(e){i.hasClass("kv-state-disabled")||t.toggle(),e.stopPropagation()})),void d(l,"click",(function(a){var n=a.target,l=e(n).length&&e(n).hasClass("kv-disable-click")||-1!==e.inArray(n.nodeName,I);b&&!l&&t.toggle()})))},load:function(t){var a=this,n=a.$cell,l=a.$detail,o=a.vKey,i=a.vInd,d=e.extend({expandRowKey:o,expandRowInd:i},R),s=!N||0===l.html().length;x.length>0&&s?e.ajax({type:"POST",data:d,url:x,beforeSend:function(){q(n),D.trigger("kvexprow:beforeLoad",[i,o,R]),l.html(T)},success:function(e){l.html(e),z(n),"function"==typeof g&&g(),t(),D.trigger("kvexprow:loaded",[i,o,R])},error:function(){l.html('<div class="alert alert-danger">Error fetching data. Please try again later.</div>'),D.trigger("kvexprow:error",[i,o,R]),z(n)}}):(z(n),"function"==typeof t&&t())},expand:function(t){var n=this,l=n.$row,o=n.$icon,d=n.$cell,s=n.$detail,r=n.vKey,c=n.vInd,p=x.length>0;if(!a(o)){p||q(d),D.find('tr[data-index="'+c+'"]').remove(),s.hide(),l.after(s);var v='<tr class="kv-expand-detail-row '+E+'" data-key="'+r+'" data-index="'+c+'">';if(s.wrap('<td colspan="'+_+'">').parent().wrap(v),o.html(w),d.attr("title",m),t?s.slideDown(K,(function(){i(o),s.show()})):(s.show(),i(o)),l.attr("data-group-key")){var f=l.prevAll("."+u),h=l.index()+1;f.push(l),e.each(f,(function(t,a){var n=e(a).find("td."+u+"[rowspan]");e.each(n,(function(t,n){var l=parseInt(e(n).attr("rowspan"));!isNaN(rowspan)&&e(a).index()+l>h&&e(n).attr("rowspan",l+1)}))}))}p||z(d)}},collapse:function(t){var a=this,l=a.$row,i=a.$icon,d=a.$cell,s=a.$detail,r=a.$container;n(i)||(t||q(d),r.html(""),i.html(k),d.attr("title",$),s.slideUp(K,(function(){var t=s.closest("tr.kv-expand-detail-row");if(t.length&&t.before(s).remove(),s.appendTo(r),o(i),l.attr("data-group-key")){var a=l.prevAll("."+u);a.push(l);var n=l.index()+1;e.each(a,(function(t,a){var l=e(a).find("td."+u+"[rowspan]");e.each(l,(function(t,l){var o=parseInt(e(l).attr("rowspan"));!isNaN(rowspan)&&e(a).index()+o>n&&e(l).attr("rowspan",o-1)}))}))}})),t||z(d))},toggle:function(){var t,l=this,o=l.$icon,i=l.$cell,d=!1,s=l.vKey,c=l.vInd;if(!i.hasClass(Q))return n(o)?((t=A&&!P)&&(U.each((function(){new r(e(this)).collapse(!0)})),d=!0),l.load((function(){l.expand(!0)})),void(t&&!d||(D.trigger("kvexprow:toggle",[c,s,R,!0]),o.focus()))):void(a(o)&&(l.collapse(),D.trigger("kvexprow:toggle",[c,s,R,!1]),o.focus()))}},c=0,p=0,v=U.length,D.data(f)||G(0),0===R.length&&(R={}),0!==v?(U.each((function(){var t=e(this),a=new r(t),n=t.find(">.kv-expand-icon");n.hasClass("kv-state-init-expanded")?(a.expand(!1),c++):n.hasClass("kv-state-init-collapsed")&&(a.collapse(!1),p++),n.removeClass("kv-state-init-expanded kv-state-init-collapsed"),a.run()})),L.length&&(v===c?J():v===p&&M(),d(L,"click",(function(){if(!L.hasClass(Q)&&0!==U.length){var l=n(O),o=a(O),i=e.extend(!0,{},t,{expandAll:o,collapseAll:l});q(L),o?(J(),D.trigger("kvexprow:toggleAll",[R,!1])):l&&(M(),D.trigger("kvexprow:toggleAll",[R,!0])),kvExpandRow(i,s)}})))):l(L,"kv-state-disabled")}}(window.jQuery);
