/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2021
 * @version   3.3.7
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2021, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
var kvExpandRow;!function(e){"use strict";kvExpandRow=function(t,n){var a=".kvExpandRowColumn",l="kvRowNum_"+n,o=t.gridId,i=t.hiddenFromExport,d=t.detailUrl,r=t.onDetailLoaded,s=t.expandIcon,c=t.collapseIcon,v=t.expandTitle,p=t.collapseTitle,f=t.expandAllTitle,u=t.collapseAllTitle,h=t.expandOneOnly,x=t.enableRowClick,g=t.rowClickExcludedTags,k=t.enableCache,w=t.extraData,$=t.msgDetailLoading,m=i?t.rowCssClass+" skip-export":t.rowCssClass,C=t.animationDuration,y=e("#"+o),A="."+n,b=y.find(".kv-expand-header-cell.kv-batch-toggle"+A),I=b.find(".kv-expand-header-icon"),R=void 0===t.collapseAll?!1:t.collapseAll,T=void 0===t.expandAll?!1:t.expandAll,E=y.find("td.kv-expand-icon-cell"+A+" .kv-expand-row:not(.kv-state-disabled)"),K=E.length,N="kv-expand-detail-loading",D=function(){var t=y.find("td.kv-expand-icon-cell"+A+":first"),n=t&&t.length?t.closest("tr"):"",a=0;return n&&n.length?(n.find("> td").each(function(){"none"!==e(this).css("display")&&a++}),a):0},j=D(),L=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},O=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},P=function(e,t){e.length&&e.removeClass(t).addClass(t)},S=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},U=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},F=function(e){P(e,N)},Q=function(e){if(e.length){var t=isNaN(C)?1e3:C+200;setTimeout(function(){e.removeClass(N)},t)}},_=function(){var e=y.data(l);return e=e?parseInt(e):0,isNaN(e)?0:e},q=function(e){y.data(l,e)},z=function(){var e=_();y.data(l,e+1)},B=function(e,t,n,l){var o=l?t:t.split(" ").join(a+" ")+a;e.length&&e.off(o).on(o,n)},G=function(e){var t=this;t.$element=e,t.init()};return G.prototype={constructor:G,init:function(){var e,t=this;t.$row=t.$element.closest("tr"),t.$icon=t.$element.find(">.kv-expand-icon"),t.$detail=t.$element.find(".kv-expanded-row"+A+":first"),t.$cell=t.$icon.closest(".kv-expand-icon-cell"),t.$container=t.$cell.find(".kv-expand-detail:first"),t.vKey=t.$detail.data("key"),t.vInd=t.$detail.data("index"),0===t.$detail.length&&(t.vKey=t.$row.data("key"),e=t.$row.next('tr.kv-expand-detail-row[data-key="'+t.vKey+'"]'),t.$detail=e.find(".kv-expanded-row"))},run:function(){var t=this,n=t.$row,a=t.$cell,l=t.$icon;if(L(l)||O(l)){if(T)return O(l)&&t.load(function(){t.expand(!0),z(),_()>=K&&(Q(b),I.focus())}),void(_()>=K&&(Q(b),I.focus()));if(R)return L(l)&&(t.collapse(),z(),_()>=K&&(Q(b),I.focus())),void(_()>=K&&(Q(b),I.focus()));L(l)&&(d?t.load(function(){t.expand(!1)}):t.expand(!1)),B(a,"click",function(e){t.toggle(),e.stopPropagation()}),B(n,"click",function(n){var a=n.target,l=e(a).length&&e(a).hasClass("kv-disable-click")||-1!==e.inArray(a.nodeName,g);x&&!l&&t.toggle()})}},load:function(t){var n=this,a=n.$cell,l=n.$detail,o=n.vKey,i=n.vInd,s=e.extend({expandRowKey:o,expandRowInd:i},w),c=k?0===l.html().length:!0;return d.length>0&&c?void e.ajax({type:"POST",data:s,url:d,beforeSend:function(){F(a),y.trigger("kvexprow:beforeLoad",[i,o,w]),l.html($)},success:function(e){l.html(e),Q(a),"function"==typeof r&&r(),t(),y.trigger("kvexprow:loaded",[i,o,w])},error:function(){l.html('<div class="alert alert-danger">Error fetching data. Please try again later.</div>'),y.trigger("kvexprow:error",[i,o,w]),Q(a)}}):(Q(a),void("function"==typeof t&&t()))},expand:function(t){var n=this,a=n.$row,l=n.$icon,o=n.$cell,i=n.$detail,r=n.vKey,s=n.vInd,v=d.length>0;if(!L(l)){v||F(o),y.find('tr[data-index="'+s+'"]').remove(),i.hide(),a.after(i);var f='<tr class="kv-expand-detail-row '+m+'" data-key="'+r+'" data-index="'+s+'">';i.wrap('<td colspan="'+j+'">').parent().wrap(f),l.html(c),o.attr("title",p),t?i.slideDown(C,function(){U(l),i.show()}):(i.show(),U(l));var u=a.prevAll(),h=a.index()+1;u.push(a),e.each(u,function(t,n){var a=e(n).find("td[rowspan]");e.each(a,function(t,a){var l=parseInt(e(a).attr("rowspan"));e(n).index()+l>h&&e(a).attr("rowspan",l+1)})}),v||Q(o)}},collapse:function(t){var n=this,a=n.$row,l=n.$icon,o=n.$cell,i=n.$detail,d=n.$container;O(l)||(t||F(o),d.html(""),l.html(s),o.attr("title",v),i.slideUp(C,function(){var t=i.closest("tr.kv-expand-detail-row");t.length&&t.before(i).remove(),i.appendTo(d),S(l);var n=a.prevAll();n.push(a);var o=a.index()+1;e.each(n,function(t,n){var a=e(n).find("td[rowspan]");e.each(a,function(t,a){var l=parseInt(e(a).attr("rowspan"));e(n).index()+l>o&&e(a).attr("rowspan",l-1)})})}),t||Q(o))},toggle:function(){var t,n=this,a=n.$icon,l=n.$cell,o=!1,i=n.vKey,d=n.vInd;if(!l.hasClass(N))return O(a)?(t=h&&!R,t&&(E.each(function(){var t=new G(e(this));t.collapse(!0)}),o=!0),n.load(function(){n.expand(!0)}),void(t&&!o||(y.trigger("kvexprow:toggle",[d,i,w,!0]),a.focus()))):void(L(a)&&(n.collapse(),y.trigger("kvexprow:toggle",[d,i,w,!1]),a.focus()))}},E.each(function(){}),y.data(l)||q(0),0===w.length&&(w={}),0===E.length?void P(b,"kv-state-disabled"):(E.each(function(){var t=e(this),n=new G(t),a=t.find(">.kv-expand-icon");L(a)&&(n.collapse(!1),n.expand(!1)),n.run()}),void(b.length&&B(b,"click",function(){if(!b.hasClass(N)&&0!==E.length){var a=O(I),l=L(I),o=e.extend(!0,{},t,{expandAll:l,collapseAll:a});F(b),l?(q(E.find(".kv-state-expanded").length),S(I),I.html(c),b.attr("title",u),y.trigger("kvexprow:toggleAll",[w,!1])):a&&(q(E.find(".kv-state-collapsed").length),U(I),I.html(s),b.attr("title",f),y.trigger("kvexprow:toggleAll",[w,!0])),kvExpandRow(o,n)}})))}}(window.jQuery);