/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2019
 * @version   3.3.5
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2019, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvExpandRow;!function(e){"use strict";kvExpandRow=function(t,n){var a=".kvExpandRowColumn",l="kvRowNum_"+n,o=t.gridId,i=t.hiddenFromExport,d=t.detailUrl,r=t.onDetailLoaded,s=t.expandIcon,c=t.collapseIcon,v=t.expandTitle,p=t.collapseTitle,f=t.expandAllTitle,u=t.collapseAllTitle,h=t.expandOneOnly,x=t.enableRowClick,g=t.rowClickExcludedTags,k=t.enableCache,w=t.extraData,$=i?t.rowCssClass+" skip-export":t.rowCssClass,m=t.animationDuration,C=e("#"+o),y="."+n,A=C.find(".kv-expand-header-cell.kv-batch-toggle"+y),I=A.find(".kv-expand-header-icon"),b=void 0===t.collapseAll?!1:t.collapseAll,R=void 0===t.expandAll?!1:t.expandAll,T=C.find("td.kv-expand-icon-cell"+y+" .kv-expand-row:not(.kv-state-disabled)"),E=T.length,K="kv-expand-detail-loading",N=function(){var t=C.find("td.kv-expand-icon-cell"+y+":first"),n=t&&t.length?t.closest("tr"):"",a=0;return n&&n.length?(n.find("> td").each(function(){"none"!==e(this).css("display")&&a++}),a):0},D=N(),j=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},O=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},P=function(e,t){e.length&&e.removeClass(t).addClass(t)},L=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},S=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},U=function(e){P(e,K)},F=function(e){if(e.length){var t=isNaN(m)?1e3:m+200;setTimeout(function(){e.removeClass(K)},t)}},Q=function(){var e=C.data(l);return e=e?parseInt(e):0,isNaN(e)?0:e},_=function(e){C.data(l,e)},q=function(){var e=Q();C.data(l,e+1)},z=function(e,t,n,l){var o=l?t:t.split(" ").join(a+" ")+a;e.length&&e.off(o).on(o,n)},B=function(e){var t=this;t.$element=e,t.init()};return B.prototype={constructor:B,init:function(){var e,t=this;t.$row=t.$element.closest("tr"),t.$icon=t.$element.find(">.kv-expand-icon"),t.$detail=t.$element.find(".kv-expanded-row"+y+":first"),t.$cell=t.$icon.closest(".kv-expand-icon-cell"),t.$container=t.$cell.find(".kv-expand-detail:first"),t.vKey=t.$detail.data("key"),t.vInd=t.$detail.data("index"),0===t.$detail.length&&(t.vKey=t.$row.data("key"),e=t.$row.next('tr.kv-expand-detail-row[data-key="'+t.vKey+'"]'),t.$detail=e.find(".kv-expanded-row"))},run:function(){var t=this,n=t.$row,a=t.$cell,l=t.$icon;if(j(l)||O(l)){if(R)return O(l)&&t.load(function(){t.expand(!0),q(),Q()>=E&&(F(A),I.focus())}),void(Q()>=E&&(F(A),I.focus()));if(b)return j(l)&&(t.collapse(),q(),Q()>=E&&(F(A),I.focus())),void(Q()>=E&&(F(A),I.focus()));j(l)&&(d?t.load(function(){t.expand(!1)}):t.expand(!1)),z(a,"click",function(e){t.toggle(),e.stopPropagation()}),z(n,"click",function(n){var a=n.target,l=e(a).length&&e(a).hasClass("kv-disable-click")||-1!==e.inArray(a.nodeName,g);x&&!l&&t.toggle()})}},load:function(t){var n=this,a=n.$cell,l=n.$detail,o=n.vKey,i=n.vInd,s=e.extend({expandRowKey:o,expandRowInd:i},w),c=k?0===l.html().length:!0;return d.length>0&&c?void e.ajax({type:"POST",data:s,url:d,beforeSend:function(){U(a),C.trigger("kvexprow:beforeLoad",[i,o,w])},success:function(e){l.html(e),F(a),"function"==typeof r&&r(),t(),C.trigger("kvexprow:loaded",[i,o,w])},error:function(){l.html('<div class="alert alert-danger">Error fetching data. Please try again later.</div>'),C.trigger("kvexprow:error",[i,o,w]),F(a)}}):(F(a),void("function"==typeof t&&t()))},expand:function(t){var n=this,a=n.$row,l=n.$icon,o=n.$cell,i=n.$detail,r=n.vKey,s=n.vInd,v=d.length>0;if(!j(l)){v||U(o),C.find('tr[data-index="'+s+'"]').remove(),i.hide(),a.after(i);var f='<tr class="kv-expand-detail-row '+$+'" data-key="'+r+'" data-index="'+s+'">';i.wrap('<td colspan="'+D+'">').parent().wrap(f),l.html(c),o.attr("title",p),t?i.slideDown(m,function(){S(l),i.show()}):(i.show(),S(l));var u=a.prevAll(),h=a.index()+1;u.push(a),e.each(u,function(t,n){var a=e(n).find("td[rowspan]");e.each(a,function(t,a){var l=parseInt(e(a).attr("rowspan"));e(n).index()+l>h&&e(a).attr("rowspan",l+1)})}),v||F(o)}},collapse:function(t){var n=this,a=n.$row,l=n.$icon,o=n.$cell,i=n.$detail,d=n.$container;O(l)||(t||U(o),d.html(""),l.html(s),o.attr("title",v),i.slideUp(m,function(){i.unwrap().unwrap(),i.appendTo(d),L(l);var t=a.prevAll();t.push(a);var n=a.index()+1;e.each(t,function(t,a){var l=e(a).find("td[rowspan]");e.each(l,function(t,l){var o=parseInt(e(l).attr("rowspan"));e(a).index()+o>n&&e(l).attr("rowspan",o-1)})})}),t||F(o))},toggle:function(){var t,n=this,a=n.$icon,l=n.$cell,o=!1,i=n.vKey,d=n.vInd;if(!l.hasClass(K))return O(a)?(t=h&&!b,t&&(T.each(function(){var t=new B(e(this));t.collapse(!0)}),o=!0),n.load(function(){n.expand(!0)}),void(t&&!o||(C.trigger("kvexprow:toggle",[d,i,w,!0]),a.focus()))):void(j(a)&&(n.collapse(),C.trigger("kvexprow:toggle",[d,i,w,!1]),a.focus()))}},C.data(l)||_(0),0===w.length&&(w={}),0===T.length?void P(A,"kv-state-disabled"):(T.each(function(){var t=new B(e(this));t.run()}),void(A.length&&z(A,"click",function(){if(!A.hasClass(K)&&0!==T.length){var a=O(I),l=j(I),o=e.extend(!0,{},t,{expandAll:l,collapseAll:a});U(A),l?(_(T.find(".kv-state-collapsed").length),L(I),I.html(c),A.attr("title",u),C.trigger("kvexprow:toggleAll",[w,!1])):a&&(_(T.find(".kv-state-expanded").length),S(I),I.html(s),A.attr("title",f),C.trigger("kvexprow:toggleAll",[w,!0])),kvExpandRow(o,n)}})))}}(window.jQuery);